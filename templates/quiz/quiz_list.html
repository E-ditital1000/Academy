{% extends 'base.html' %}

{% block title %}
    {{ title }}
{% endblock %}

{% load i18n %}
{% load static %}

{% block content %}
    <div id="input-nav">
        <a href="{% url 'home' %}" class="primary1">Home</a> &rsaquo; 
        <a href="{% url 'programs' %}" class="primary1">Programs</a> &rsaquo; 
        <a href="{% url 'program_detail' pk=1 %}" class="primary1">{{ course.program }}</a> &rsaquo; 
        <a href="{{ course.get_absolute_url }}" class="primary1">{{ course }}</a> &rsaquo; Quiz List
    </div>

    <div class="container">
        {% if messages %}
            <div id="popup-box-messages">
                <div class="box-messages">
                    <a id="popup-btn-messages" class="btn btn-light"><i class="fas fa-times"></i></a><br><br>
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        <div class="header-title-xl text-center">Quiz list of {{ course }}</div>
        <div class="title-line mb-5"></div>

        {% if request.user.is_superuser or request.user.is_lecturer %}
            <a class="btn btn-outline-primary br-2 mb-4" href="{% url 'quiz_create' course.slug %}">&plus; Add Quiz</a>
        {% endif %}

        <style>
            /* Styles for update-delete wrapper */
            .update-delete-wrapper {
                position: relative;
                display: inline-block;
            }

            /* Styles for navbar */
            .navbar {
                display: inline-block;
                position: relative;
            }

            /* Styles for dropdown menu */
            .dropdown-menu {
                position: absolute;
                right: 0;
                z-index: 1;
            }

            .dropdown-menu .dropdown-item {
                color: #000;
            }

            .dropdown-menu .dropdown-item:hover {
                background-color: #f8f9fa;
            }

            .dropdown-toggle-split {
                cursor: pointer;
            }
        </style>

        <div class="row">
            {% for quiz in quizzes %}
                <div class="col-md-4 mb-4 mx-auto text-center">
                    <div class="card p-2 quiz-wrapper">
                        {% if request.user.is_superuser or request.user.is_lecturer %}
                            <div class="update-delete-wrapper">
                                <div class="navbar">
                                    <li class="dropdown">
                                        <a class="dropdown-toggle-split" href="#" id="dropdown01" data-toggle="dropdown">
                                            <i class="fas fa-ellipsis-v text-white"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdown01">
                                            <a href="{% url 'quiz_update' slug=course.slug pk=quiz.id %}" class="update">
                                                <i class="fas fa-pencil-alt"></i> Edit
                                            </a>
                                            <a href="{% url 'quiz_delete' slug=course.slug pk=quiz.id %}" class="delete">
                                                <i class="fas fa-trash-alt"></i> Delete
                                            </a>
                                        </div>
                                    </li>
                                </div>
                            </div>
                        {% endif %}

                        <div class="row text-success mb-4">
                            <em class="col-6 text-left">{{ quiz.category|title }} Quiz</em>
                        </div>

                        <div class="card-title header-title-md">{{ quiz.title|title }}</div>

                        {% if quiz.single_attempt %}
                            <p class="p-2 bg-light-warning">{% trans "You will only get one attempt at this quiz" %}.</p>
                        {% endif %}

                        <p class="text-muted">{{ quiz.description }}</p>

                        <a class="btn btn-block btn-secondary" href="{% url 'quiz_take' pk=course.pk slug=quiz.slug %}">
                            {% trans "Start quiz" %} &raquo;
                        </a>
                    </div>
                </div>

                {% if forloop.counter|divisibleby:3 %}
                    </div><div class="row">
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block js %}
<script>
    $(document).ready(function() {
        $('.dropdown-toggle-split').on('click', function(e) {
            e.preventDefault();
            $(this).siblings('.dropdown-menu').toggleClass('show');
        });

        // Close dropdown menu on outside click
        $(document).on('click', function(e) {
            if (!$('.dropdown-toggle-split').is(e.target) && $('.dropdown-toggle-split').has(e.target).length === 0 &&
                $('.dropdown-menu').has(e.target).length === 0) {
                $('.dropdown-menu').removeClass('show');
            }
        });
    });

    var timer = setInterval(function(){
        document.getElementById('progress-card').style.display = 'block';
        document.getElementById('progress-main').style.display = 'block';
        clearInterval(timer);
    }, 8000);
</script>
{% endblock %}
